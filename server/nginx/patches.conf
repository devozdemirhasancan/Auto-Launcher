# Nginx configuration for CanartWorks Launcher Patch Server
# Place this in /etc/nginx/sites-available/patches
# Then ln -s /etc/nginx/sites-available/patches /etc/nginx/sites-enabled/

server {
    listen 80;
    server_name patches.canartworks.com;  # Replace with your domain

    root /var/www/patches;
    index index.html index.htm;

    # Enable range requests for resumable downloads
    accept_ranges on;

    # For large files, use sendfile for efficiency
    sendfile on;

    # Channels endpoint - no cache, always fresh
    location /channels/ {
        add_header Cache-Control "no-cache";
        add_header X-Content-Type-Options nosniff;
        try_files $uri =404;
    }

    # Manifests endpoint - no cache, but short TTL possible
    location /manifests/ {
        add_header Cache-Control "no-cache";
        add_header X-Content-Type-Options nosniff;
        try_files $uri =404;
    }

    # Files endpoint - immutable, long cache
    location /files/ {
        add_header Cache-Control "public, max-age=31536000, immutable";
        add_header X-Content-Type-Options nosniff;
        try_files $uri =404;
    }

    # Admin endpoint (future)
    # location /admin/ {
    #     # Auth required
    # }

    # Default deny
    location / {
        deny all;
    }

    # Logs
    access_log /var/log/nginx/patches_access.log;
    error_log /var/log/nginx/patches_error.log;
}
